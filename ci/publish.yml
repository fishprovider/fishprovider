include:
  - local: /ci/base.yml

publish-cross:
  rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
      changes:
        - packages/cross/**/*
      when: always
    - if: $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH
      changes:
        - packages/cross/**/*
      when: always
    - when: never
  # cache:
  #   key: npm-cross-$CI_COMMIT_REF_SLUG
  #   paths:
  #     - .npm
  #     - node_modules
  extends: .deploy_notif
  script:
    - npm run install-packages -w packages/cross
    - npm run build -w packages/cross
    - echo "//${CI_SERVER_HOST}/api/v4/projects/${CI_PROJECT_ID}/packages/npm/:_authToken=${CI_JOB_TOKEN}" > packages/cross/dist/.npmrc
    - npm run publish -w packages/cross
