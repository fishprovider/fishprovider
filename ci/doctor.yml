include:
  - local: /ci/base.yml

doctor:
  tags:
    - local
  stage: test
  rules: !reference [.rule_default_branch, rules]
  cache: !reference [.cache_npm, cache]
  script:
    - npm ci --cache .npm --prefer-offline --no-audit --no-progress --legacy-peer-deps
    - npm run doctor
  timeout: 15

doctor-error:
  stage: clean
  when: on_failure
  script:
    - NOTIF_MSG="[Error] Doctor failed $CI_COMMIT_REF_NAME $CI_COMMIT_SHA"
    - !reference [.notif, script]
