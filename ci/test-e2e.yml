include:
  - local: /ci/base.yml

test-e2e:
  image: mcr.microsoft.com/playwright:next
  stage: test
  rules: !reference [.rule_skip_title_tag, rules]
  cache:
    key: e2e-$CI_COMMIT_REF_SLUG
    paths:
      - .npm
      - node_modules
      - /ms-playwright
  before_script:
    - !reference [.install_doppler, script]
  script:
    - npm i --cache .npm --prefer-offline --no-audit --no-progress --legacy-peer-deps
    - npx playwright install --with-deps
    - npm run test:e2e
